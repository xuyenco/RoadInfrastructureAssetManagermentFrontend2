@page
@model RoadInfrastructureAssetManagementFrontend.Pages.Users.IndexModel
@{
}

<!DOCTYPE html>
<html>
<head>
    <!-- Thêm Font Awesome để sử dụng biểu tượng -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        body { background-color: #f8f9fa; }
        .container { margin-top: 20px; }
        .h1, .h3 { color: #343a40; font-weight: bold; }
        .table-container { background-color: #fff; border-radius: 8px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); padding: 20px; }
        .btn-primary { transition: background-color 0.3s; }
        .btn-primary:hover { background-color: #0056b3; }
        .thead-light th { background-color: #e9ecef; color: #495057; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Danh sách Người dùng</h1>
    </div>

    <div class="text-center table-container">
        <p class="h3 p-3">Danh sách Người dùng</p>
        <div class="row mb-3">
            <div class="col-md-4">
                <input type="text" class="form-control" placeholder="Tìm kiếm theo vai trò..." id="searchInput">
            </div>
        </div>
        <div>
            <a class="btn btn-primary btn-sm mb-3" href="/Users/Create">
                <i class="fas fa-plus"></i> Tạo Người dùng mới
            </a>
            <div class="table-responsive">
                <table class="table table-bordered table-sm table-striped">
                    <thead class="thead-light">
                        <tr>
                            <th>Mã Người dùng</th>
                            <th>Tên đăng nhập</th>
                            <th>Họ và Tên</th>
                            <th>Email</th>
                            <th>Vai trò</th>
                            <th>Ngày tạo</th>
                            <th>Thao tác</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var user in Model.Users)
                        {
                            <tr>
                                <td>@user.user_id</td>
                                <td>@user.username</td>
                                <td>@user.full_name</td>
                                <td>@user.email</td>
                                <td>@user.role</td>
                                <td>@(user.created_at.HasValue ? user.created_at.Value.ToString("dd/MM/yyyy HH:mm") : "Chưa có dữ liệu")</td>
                                <td>
                                    <a class="btn btn-info btn-sm" href="/Users/Detail?id=@user.user_id" data-toggle="tooltip" title="Xem chi tiết">
                                        <i class="fas fa-eye"></i> Chi tiết
                                    </a>
                                    <button class="btn btn-danger btn-sm delete-btn" data-id="@user.user_id" data-toggle="tooltip" title="Xóa người dùng">
                                        <i class="fas fa-trash-alt"></i> Xóa
                                    </button>
                                    <a class="btn btn-secondary btn-sm" href="/Users/Update?id=@user.user_id" data-toggle="tooltip" title="Cập nhật người dùng">
                                        <i class="fas fa-edit"></i> Cập nhật
                                    </a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Script cho tìm kiếm và tooltip -->
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script>
        $(document).ready(function(){
            $('[data-toggle="tooltip"]').tooltip();
        });

        $('.delete-btn').on('click', function () {
            const userId = $(this).data('id');
            if (confirm('Bạn có chắc chắn muốn xóa người dùng này?')) {
                $.ajax({
                    url: '/Users/Index?handler=Delete', // Gọi handler Delete trong PageModel
                    type: 'POST',
                    data: { id: userId },
                    headers: {
                        "RequestVerificationToken": $('input[name="__RequestVerificationToken"]').val() // CSRF token
                    },
                    success: function (response) {
                        if (response.success) {
                            $(`tr[data-task-id="${userId}"]`).remove(); // Xóa hàng khỏi bảng
                            alert('Xóa người dùng thành công!');
                        } else {
                            alert('Xóa người dùng thất bại: ' + response.message);
                        }
                    },
                    error: function () {
                        alert('Đã xảy ra lỗi khi xóa người dùng.');
                    }
                });
            }
        });

        document.getElementById("searchInput").addEventListener("keyup", function() {
            let filter = this.value.toLowerCase();
            let rows = document.querySelectorAll("tbody tr");

            rows.forEach(row => {
                let role = row.cells[4].textContent.toLowerCase(); // Lọc theo cột role
                row.style.display = role.includes(filter) ? "" : "none";
            });
        });
    </script>
</body>
</html>